  @startuml
    actor UżytkownikUwierzytelniony as U
    participant Strona
    participant FormularzEdycjiAdresuEmail
    control AccountService
    entity Account

  U -> Strona: Naciśnij przycisk "Edytuj adres e-mail"
  Strona -> FormularzEdycjiAdresuEmail: Załaduj formularz edycji adresu e-mail
  group <<transaction>> RW, READ COMMITTED, zakres: \n- wykonanie zapytania do tabeli account,\n- edycja rekordu tabeli account

  FormularzEdycjiAdresuEmail --> AccountService: Załaduj dane do formularz edycji adresu e-mail
    activate AccountService
  AccountService -> Account: Pobierz dane do formularz edycji adresu e-mail
    activate Account
  Account --> AccountService: Pobrano dane do formularz edycji adresu e-mail
  AccountService --> FormularzEdycjiAdresuEmail: Załadowano dane do formularza edycji adresu e-mail
  U -> FormularzEdycjiAdresuEmail: Wprowadź nowy adres e-mail

  FormularzEdycjiAdresuEmail -> AccountService: Zatwierdź formularz zmiany adresu e-mail użytkownika
    alt wprowadzony adres e-mail jest niepoprawny
    opt format wprowadzonego adresu e-mail jest niepoprawny
    AccountService --> FormularzEdycjiAdresuEmail: Format wprowadzonego adresu e-mail jest niepoprawny
    FormularzEdycjiAdresuEmail --> Strona: Pokaż ostrzeżenie o niepoparwnym formacie wprowadzonego adresu e-mail
    else wprowadzony adres e-mail jest już przypisany do istniejącego konta
    FormularzEdycjiAdresuEmail -> AccountService: Sprawdź czy wprowadzony adres e-mail jest już przypisany do istniejącego konta
    AccountService --> FormularzEdycjiAdresuEmail: Wprowadzony adres e-mail jest już przypisany do istniejącego konta
    FormularzEdycjiAdresuEmail --> Strona: Pokaż ostrzeżenie o przypisaniu adresu e-mail do istniejącego konta
    end
    else wprowadzony adres e-mail jest poprawny
    group inicjonowane na podstawie przycisku "Wyślij link autoryzujący"
    AccountService --> U: Wyślij wiadomość pocztową w linkiem autoryzującym czynność zmiany adresu e-mail
      alt autoryzacja czynności zmiany adresu e-mail nie została uzyskana (wygaśnięcie linku
      AccountService --> Strona: Pokaż ostrzeżenie o nieudanej zmianie adresu e-mail
      else autoryzacja czynności zmiany adresu e-mail została uzyskana
      AccountService -> Account: Zmień pole email obiektu Account
      Account --> AccountService: Wartość pola email obiektu Account została zmieniona
      AccountService --> Strona: Dane osobowe zostały zaktualizowane
      end
    end
    end
    end
    
    @enduml